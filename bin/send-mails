#!/usr/bin/env ruby -wU
=begin

  @usages

    send-mail "path/to/file/mail.md" [options]

    send-mail -h

    send-mail manuel[ -dev]

  Pour implémenter cette commande, jouer :

    ln -s /Users/philippeperret/Programmes/Mailing/bin/send-mails /usr/local/bin/send-mails

=end
require 'clir'
require_relative '../lib/required'

CLI.init
if help?
  clear
  puts <<~TEXT
  #{'*****************************'.bleu}
  #{'***   Aide de send-mail   ***'.bleu}
  #{'*****************************'.bleu}
  
  send-mail est une commande qui permet d'envoyer un mail ou un 
  mailing à partir d'un unique fichier markdown définissant aussi 
  bien le contenu que les destinataires et les conditions d'envoi.

  #{'Usage simple'.bleu}
  #{'------------'.bleu}

      #{'send-mail /path/to/file.md'.jaune}

          Procède à l'envoi du mail défini dans file.md à l'adresse
          indiquée.

  #{'Ouverture du fichier mail'.bleu}

      #{'send-mail open /path/to/file.md'.jaune}

  #{'Une aide rapide'.bleu}

      #{'send-mail -h'.jaune}

  #{'Ouverture du manuel'.bleu}

      #{'send-mail manuel'.jaune}

      Ajouter l'option #{'-dev'.jaune} pour l'ouvrir en édition.

  TEXT
else
  case CLI.main_command
  when 'manuel','manual'
    #
    # Ouverture du manuel
    # 
    SUPERVISOR.open_manuel(CLI.option(:dev))
  when 'open'
    #
    # Ouverture du fichier md Mailing
    # 
    SUPERVISOR.open_mailing_file(CLI.component.first)
  else
    #
    # Envoi du mailing
    # 
    mail_file_path = CLI.main_command
    mail_file_path = File.expand_path(mail_file_path) if mail_file_path
    FileBox.new(mail_file_path).send(**CLI.options)
  end
end
